## ASSUMPTIONS

This Build Server application assumes that:

- all related C program files are packaged into an expected structure (i.e. files are contained within a directory whose name is the same as the prefix of the target file, and the directory is contained within a zip file whose prefix is the same as directory's name). 

    **NOTE**: Application will automatically skip over (and locally remove from Build Server) any invalid zip packages, well as any other unexpected files that may randomly exist in targeted Git repo.

- at most 1 instance of application in on-demand mode and 1 instance of application in auto mode is required to be able to run concurrently with each other.

    **NOTE**: User will be notified if another instance is already running in same mode and application will exit.

    **NOTE**: If an instance in one mode is started during the build cycle of the other mode, the instance will wait until the build cycle of the other instance is complete before beginning its own build cycle (excluding the period of time between build cycles that occur in auto mode).

- records shall be automatically removed for any build attempts that were not fully completed due to an unexpected runtime error or user-signaled exit (as opposed to, for example, being left in place with an updated status of INCOMPLETE and obscuring records for fully completed build attempts).

## AUTOMATICALLY BUILD IMAGE FROM SOURCE

To automatically configure and/or clean up local build environment and build Build Server image locally from source code.

***NOTE***:  Not all required environment configurations (permissions, tools, etc.) may be covered by the following script. 

***WARNING***:  Any and all pre/existing Docker objects generated by this project will be removed, including volumes.

    sh build-buildserver-image.sh

## MANUALLY BUILD IMAGE W/ DOCKER COMPOSE

To manually build Docker image:

> docker compose build `<docker compose service name>`

e.g.

    docker compose build buildserver_svc

## AUTOMATICALLY RUN PRE-BUILT REMOTE IMAGE (OR IMAGE BUILT LOCALLY FROM SOURCE) AS CONTAINER AND START DEMO 

To automatically prepare container environment, download Build Server image from DockerHub (if it does not already exist locally), run it as a container (which will deploy and initialize a MySQL database and start a Flask web server), and run the Build Server demo. 

***NOTE***:  Only requires container-demo-script.sh file to exist in same directory in which it is executed.  Does not require any other project files.  Entire set of project files on GitHub are only needed if re/building Build Server image from scratch.

***WARNING***:  An attempt will be made to first halt any processes associated with user-specified port.

***WARNING***:  Any container and volume previously spawned by this script will be removed.

> bash run_demo.sh

## MANUALLY RUN IMAGE AS CONTAINER

To manually create and start Docker container from image using Docker Compose:

> docker compose run `<docker compose service name>`

e.g.

    docker compose run buildserver_svc

-- OR --

To manually create and start Docker container from image without using Docker Compose (***NOTE***: Port mapping should match Flask port): 

> docker run -p `<src port>`:`<dst port>` -e MYSQL_ROOT_PASSWORD='`<password>`' `<image name>:<image tag>` 

e.g.

    docker run -p 5000:5000 -e MYSQL_ROOT_PASSWORD='D3v0p$2' buildserver_img:latest 

## MANUALLY RUN COMMANDS INSIDE CONTAINER

To run commands within running container:

    docker exec -it <container hash> bash

## THE 'BUILD SERVER' DATABASE (DB)

To log into MySQL from within container and initialize database:

> mysql -u root -p'`<password>`' -P `<port>` -h `<ip>` < "../`<database init script>`.sql"

e.g.

    mysql -u root -p'D3v0p$2' -P 3306 -h 0.0.0.0 < "../buildserver-init-db.sql"

## THE 'BUILD SERVER' WEB PAGE (GUI)

To manually start Flask app:

> exec gunicorn -w 1 --timeout 200 --bind `<ip>`:`<port>` `<module name>`:`<container/app name>`

e.g.

    exec gunicorn -w 1 --timeout 200 --bind 127.0.0.1:5000 buildserver_mod:buildserver_con

## THE 'BUILD SERVER' APPLICATION (BIZ)

To start Build Server application in on-demand mode (w/ default url and interval):

    python -u buildserver_mod.py --mode o

To start Build Server application in auto mode (w/ default url and interval):

    python -u buildserver_mod.py --mode a

To start Build Server application with a given interval (w/ default mode and url):

    python -u buildserver_mod.py --interval 300

To specify a .git or .zip URL (w/ default mode and interval):

> python -u buildserver_mod.py --url `<URL>`

e.g.
```
python -u buildserver_mod.py --url https://github.com/jsandreyo/repo_a/hello8.zip
```
```
python -u buildserver_mod.py --url https://github.com/jsandreyo/repo_b.git
```

**Auto Mode**: will process a given or assumed remote Git resource every x number of seconds.

**On-Demand Mode**: will process a given or assumed remote Git resource one time through.

**NOTE**: Both modes can be used in combination with any qualified Git URL ending in either .git or .zip.

## APPLICATION DEFAULT VALUES

**NOTE**:

- Auto mode is default build cycle mode.  To reconfigure this default value, edit global **DEFAULT_BUILD_CYCLE_MODE** constant in **g_.py**.

- https://github.com/jsandreyo/repo_b.git is default remote Git resource.  To reconfigure this default value, edit global **DEFAULT_GIT_REPO_URL** constant in **g_.py**.

- 180 seconds (3 minutes) is default interval for continuous build cycles.  To reconfigure this default value, edit global **DEFAULT_INTERVAL_SECONDS** constant in **g_.py**

##

Author: John Andreyo \
Copyright: Copyright (c) 2024. All rights reserved. \
License: Please see LICENSE file in project's root. \
Version: 2.1
